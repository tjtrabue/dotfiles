#+title:    COMINT: Generic REPL Mode
#+author:   Tom Trabue
#+email:    tom.trabue@gmail.com
#+date:     2021:07:13
#+property: header-args:emacs-lisp :lexical t
#+tags:
#+STARTUP: fold

=comint-mode= (which stands for "Command Interpreter") is a built-in, generic
framework for designing modes for interacting with REPLs. Many other major modes
inherit from =comint-mode=, such as =sly-mrepl-mode=.

* Functions
  #+begin_src emacs-lisp
    (defun my/comint-search-history ()
      "Search `comint-mode' input history and insert the selected command at point."
      (interactive)
      (let* ((curr-cmd-line (buffer-substring (comint-line-beginning-position) (line-end-position)))
             (command       (my-completing-read-comint-input-ring curr-cmd-line)))
        (delete-region (comint-line-beginning-position) (line-end-position))
        (insert command)))
  #+end_src

* =use-package= specification
#+begin_src emacs-lisp
  (use-package comint
    :after evil
    :demand t
    ;; This is a built-in feature, so we don't want to clone or install
    ;; anything.
    :ensure nil
    :straight nil
    :general
    (general-def comint-mode-map
      ;; Search backward through history using completing-read.
      "C-r" 'my/comint-search-history)
    (general-def 'insert comint-mode-map
      "C-j" 'comint-next-input
      "C-k" 'comint-previous-input)
    :custom
    ;; Increase the comint buffer (e.g., history) size.
    (comint-buffer-maximum-size 20000)
    ;; Make the prompt read only.
    (comint-prompt-read-only t))
#+end_src
