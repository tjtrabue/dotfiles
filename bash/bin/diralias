#!/usr/bin/env bash

set -e

################################################################################
##                                                                            ##
##                             Supporting Functions                           ##
##                                                                            ##
################################################################################

# Takes care of any final operations before the script exits:
function cleanup() {
    local f
    for f in ~/.{dirs,vars,path}; do
        . "$f"
    done
}
trap cleanup EXIT

# Used for printing errors:
function echoe () { echo -e "${RED}ERROR${NC}: $@" 1>&2 ; }

# Used for printing warnings:
function echow () { echo -e "${BROWN_ORANGE}WARNING${NC}: $@" 1>&2 ; }

################################################################################
##                                                                            ##
##                                  Variables                                 ##
##                                                                            ##
################################################################################

declare dir_alias_file=~/".dirs"
declare short_path="$(shortpath "$(pwd)")";

################################################################################
##                                                                            ##
##                                 Main Program                               ##
##                                                                            ##
################################################################################

sed -i "s:export\ $1=.*::g" "$dir_alias_file";
perl -pi -e 'chomp if eof' "$dir_alias_file" && echo >> "$dir_alias_file"
echo -n "export $1=\"$short_path\"" >> "$dir_alias_file";
. ~/.dir