#!/usr/bin/env bash

set -e

################################################################################
##                                                                            ##
##                             Supporting Functions                           ##
##                                                                            ##
################################################################################

# Takes care of any final operations before the script exits:
function cleanup() {
    local f
    for f in ~/.{dirs,vars,path}; do
        source "$f"
    done
}
trap cleanup EXIT

# Used for printing errors:
function echoe () { echo -e "${RED}ERROR${NC}: $@" 1>&2 ; }

# Used for printing warnings:
function echow () { echo -e "${BROWN_ORANGE}WARNING${NC}: $@" 1>&2 ; }


################################################################################
##                                                                            ##
##                                  Variables                                 ##
##                                                                            ##
################################################################################

short_path="$(shortpath "$(pwd)")";


################################################################################
##                                                                            ##
##                                 Main Program                               ##
##                                                                            ##
################################################################################

sed -i "s:export\ $1=.*::g" "$DIR_ALIAS_FILE";
perl -pi -e 'chomp if eof' "$DIR_ALIAS_FILE" && echo >> "$DIR_ALIAS_FILE"
echo -n "export $1=\"$short_path\"" >> "$DIR_ALIAS_FILE";
source "$DIR_ALIAS_FILE"