#!/usr/bin/env bash

################################################################################
##                                                                            ##
##                               Usage Functions                              ##
##                                                                            ##
################################################################################

# Full help message
function _matrix_menu_help() {
    echo "A two-dimensional selection menu that the user can navigate" 1>&2
    echo "with the arrow keys. Note that this is NOT the binary that should" 1>&2
    echo "be called by the end user. They should use matrix_menu instead," 1>&2
    echo "which is used the exact same way." 1>&2
}

# Usage message
function _matrix_menu_usage() {
    echo "Usage:" 1>&2
    echo "This binary is used by calling _matrix_menu and one or more -r flags with the data" 1>&2
    echo "for each row after each -r flag." 1>&2
    echo "    _matrix_menu -r [row1_option1 [row1_option2 ...] -r [ [row2_option1 ...]]" 1>&2
}

################################################################################
##                                                                            ##
##                               Exit Functions                               ##
##                                                                            ##
################################################################################

# Exit the program if the user requests the help message:
function exit_if_help_requested () {
    if [[ "$1" == "-h" || "$1" == "--help" ]]; then
        _matrix_menu_help
        exit 0
    fi
}

# Exit the program if the user enters input incorrectly
function exit_if_input_incorrect () {
    if [[ "$#" -eq 0 ]]; then
        echoe "Need one or more rows of data"
        _matrix_menu_usage
    fi
}

################################################################################
##                                                                            ##
##                             Supporting Functions                           ##
##                                                                            ##
################################################################################

# Parse the input and create rows for the matrix:
function parse_input() {
    local input="$@"
    local token
    local current_row_count=0
    for token in $input; do
        if [[ "$token" == "-r" ]]; then
            (( num_rows+=1 ))
            current_row_count=0
        else
            (( current_row_count+=1 ))
            if [[ "$current_row_count" -gt "$num_rows" ]]; then
                (( num_rows+=1 ))
            fi
        fi
    done
}

# Used for printing errors:
function echoe () { echo -e "${RED}ERROR${NC}: $@" 1>&2 ; }

# Used for printing warnings:
function echow () { echo -e "${BROWN_ORANGE}WARNING${NC}: $@" 1>&2 ; }

################################################################################
##                                                                            ##
##                                  Variables                                 ##
##                                                                            ##
################################################################################

# Indicates when the program should end
end=false

# The associative array that will hold the rows of options
declare -A matrix

# The number of rows in the two-dimensinoal menu
num_rows=0

# The number of columns in the two-dimensional menu
num_columns=0

################################################################################
##                                                                            ##
##                                 Main Program                               ##
##                                                                            ##
################################################################################

# Figure out option rows
parse_input "$@"

# Begin main program loop:
while ! $end; do

done # End main program loop