#!/usr/bin/env bash

trap 's=$?; echo "$0: Error on line "$LINENO": $BASH_COMMAND"; exit $s' ERR
set -Eeuo pipefail

# Variables {{{
DOTFILES_REPO="${HOME}/.dotfiles"
# }}}

# Imports {{{
. "${DOTFILES_REPO}/shell/common/source/common.sh" && src
# }}}

# Functions {{{
install_emacs_arch() {
  local workspaceDir="${WS:-${HOME}/workspace}"
  local emacsPackageName="emacs-native-comp-git-enhanced"
  (
    cd "${workspaceDir}"
    paru -G "${emacsPackageName}"
    cd "${emacsPackageName}"
    makepkg -si
  )
}

# Install emacs from source
install_emacs_source() {
  local emacsGitUrl="https://github.com/emacs-mirror/emacs.git"
  local emacsDest="${WS:-${HOME}/workspace}/emacs"

  mkdir -p "$(dirname "${emacsDest}")"
  log_info "Cloning/Updating Emacs Git Repo"
  clone_or_update_git_repo "${emacsGitUrl}" "${emacsDest}"
  (
    log_info "Installing latest Emacs" && \
    cd "${emacsDest}" && \
    ./autogen.sh && \
    ./configure --with-json --with-tree-sitter --with-xwidgets \
      --with-imagemagick --with-mailutils --with-native-compilation=aot \
      --with-pgt && \
    make -j$(nproc) && \
    sudo make install
  )
}

main() {
  print_header "Installing Emacs (the best editor!)"
}
# }}}

main "${@}"

# vim:foldenable:foldmethod=marker: